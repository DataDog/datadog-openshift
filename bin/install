#!/bin/bash

apikey="$DATADOG_API_KEY"
dd_home="$OPENSHIFT_DATADOG_DIR/dd-agent"
is_openshift=1 # Used to tell virtualenv to use the system variables

if [ $apikey ]; then

	# Install the DD agent from source
	DD_API_KEY=$apikey DD_HOME=$dd_home DD_START_AGENT=0 IS_OPENSHIFT=$is_openshift sh -c "$(curl -L http://dtdg.co/dd-agent-source)"
	
	# Set and uncomment bind_host parameter
	sed -i "s/# bind_host:.*/bind_host: $OPENSHIFT_DATADOG_IP/" $dd_home/agent/datadog.conf 2>> $logfile
	
else
	# Generate an error to prevent the Cartridge from being added
	exit "Error: no API key has been defined prior to installation"
fi;
